$(function(){function trim(el){return(''.trim)?el.val().trim():$.trim(el.val());}
$.fn.isHappy=function(config){var fields=[],item;function getError(error){return $('<span id="'+error.id+'" class="errorMessage">'+error.message+'</span>');}
function handleSubmit(){var errors=false,i,l;for(i=0,l=fields.length;i<l;i+=1){if(!fields[i].testValid(true)){errors=true;}}
if(errors){if(isFunction(config.unHappy))config.unHappy();return false;}else if(config.testMode){if(window.console)console.warn('would have submitted');return false;}}
function isFunction(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply);}
function processField(opts,selector){var field=$(selector),error={message:opts.message||'',id:selector.slice(1)+'_unhappy'},errorEl=$(error.id).length>0?$(error.id):getError(error);fields.push(field);field.testValid=function(submit){var val,el=$(this),gotFunc,error=false,temp,required=!!el.get(0).attributes.getNamedItem('required')||opts.required,password=(field.attr('type')==='password'),arg=isFunction(opts.arg)?opts.arg():opts.arg;if(isFunction(opts.clean)){val=opts.clean(el.val());}else if(!opts.trim&&!password){val=trim(el);}else{val=el.val();}
el.val(val);gotFunc=((val.length>0||required==='sometimes')&&isFunction(opts.test));if(submit===true&&required===true&&val.length===0){error=true;}else if(gotFunc){error=!opts.test(val,arg);}
if(error){el.addClass('error').before(errorEl);return false;}else{temp=errorEl.get(0);if(temp.parentNode){temp.parentNode.removeChild(temp);}
el.removeClass('error');return true;}};field.bind(config.when||'blur',field.testValid);}
for(item in config.fields){processField(config.fields[item],item);}
if(config.submitButton){$(config.submitButton).click(handleSubmit);}else{this.bind('submit',handleSubmit);}
return this;};});(function(a){var r=a.fn.domManip,d="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},f={},e,p={key:0,data:{}},h=0,c=0,l=[];function g(e,d,g,i){var c={data:i||(d?d.data:{}),_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};e&&a.extend(c,e,{nodes:[],parent:d});if(g){c.tmpl=g;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++h;(l.length?f:b)[h]=c}return c}a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a.fn[d].apply(a(i[h]),k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,l,j){if(d[0]&&d[0].nodeType){var f=a.makeArray(arguments),g=d.length,i=0,h;while(i<g&&!(h=a.data(d[i++],"tmplItem")));if(g>1)f[0]=[a.makeArray(d)];if(h&&c)f[2]=function(b){a.tmpl.afterManip(this,b,j)};r.apply(this,f)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var j,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(i(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h==="function")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);j=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(i(c,null,j)):j},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b==="string")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,"tmpl")||a.data(b,"tmpl",o(b.innerHTML));return typeof c==="string"?(a.template[c]=b):b}return c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function i(e,g,f){var b,c=f?a.map(f,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+e.key+'" $2'):a:i(a,e,a._ctnt)}):e;if(g)return c;c=c.join("");c.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=j(c).concat(b);if(d)b=b.concat(j(d))});return b?b:j(c)}function j(c){var b=document.createElement("div");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+a.trim(b).replace('%7B','{','g').replace('%7D','}','g').replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(m,l,j,d,b,c,e){var i=a.tmpl.tag[j],h,f,g;if(!i)throw"Template command not found: "+j;h=i._default||[];if(c&&!/\w$/.test(b)){b+=c;c=""}if(b){b=k(b);e=e?","+k(e)+")":c?")":"";f=c?b.indexOf(".")>-1?b+c:"("+b+").call($item"+e:b;g=c?f:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"}else g=f=h.$1||"null";d=k(d);return"');"+i[l?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(g).split("$1").join(f).split("$2").join(d?d.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(d,c,b,a){a=a?","+a+")":b?")":"";return a?"("+c+").call($item"+a:d}):h.$2||"")+"_.push('"})+"');}return _;")}function n(c,b){c._wrap=i(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join("")}function k(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n="_"+c,k,j,l={},e,p,i;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName("*");for(i=j.length-1;i>=0;i--)m(j[i]);m(k)}function m(j){var p,i=j,k,e,m;if(m=j.getAttribute(d)){while(i.parentNode&&(i=i.parentNode).nodeType===1&&!(p=i.getAttribute(d)));if(p!==m){i=i.parentNode?i.nodeType===11?0:i.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[i]||f[i],null,true);e.key=++h;b[h]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,"tmplItem"))){o(e.key);b[e.key]=e;i=a.data(j.parentNode,"tmplItem");i=i?i.key:0}if(e){k=e;while(k&&k.key!=i){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,"tmplItem",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent,null,true)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(d||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery)
$(function(){(function(Date,undefined){var origParse=Date.parse,numericKeys=[1,4,5,6,7,10,11];Date.parse=function(date){var timestamp,struct,minutesOffset=0;if((struct=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(date))){for(var i=0,k;(k=numericKeys[i]);++i){struct[k]=+struct[k]||0;}
struct[2]=(+struct[2]||1)-1;struct[3]=+struct[3]||1;if(struct[8]!=='Z'&&struct[9]!==undefined){minutesOffset=struct[10]*60+struct[11];if(struct[9]==='+'){minutesOffset=0-minutesOffset;}}
timestamp=Date.UTC(struct[1],struct[2],struct[3],struct[4],struct[5]+minutesOffset,struct[6],struct[7]);}else{timestamp=origParse?origParse(date):NaN;}
return timestamp;}}(Date));});$(function(){function timeSince(oldD,short){var days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];newD=new Date();diff=Math.round((newD.getTime()-oldD.getTime())/1000);isSameDay=(oldD.getDate()==newD.getDate()&&oldD.getMonth()==newD.getMonth()&&oldD.getFullYear()==newD.getFullYear());if(isSameDay){if(diff<60){return"secs"+(!short?" ago":'');}else if(diff<3600){var n=Math.floor(diff/60);return n+" min"+(n==1?'':'s')+(!short?" ago":'');}else{var n=Math.floor(diff/3600);return n+" hour"+(n==1?'':'s')+(!short?" ago":'');}}else{newD.setDate(newD.getDate()-1);isYesterday=(oldD.getDate()==newD.getDate()&&oldD.getMonth()==newD.getMonth()&&oldD.getFullYear()==newD.getFullYear());if(isYesterday){return"Yesterday";}else{newD.setDate(newD.getDate()-6);if(oldD>newD)
return days[oldD.getDay()];else{var day=oldD.getDate();var month=oldD.getMonth()+1;return((day<10)?'0':'')+day+"/"+((month<10)?'0':'')+month+"/"+(!short?oldD.getFullYear():'');}}}}
(function updateTimes(){$('time').each(function(index,value){$this=$(this);d=new Date($this.attr('datetime'));$this.text(timeSince(d,$this.hasClass('short')));});setTimeout(updateTimes,10000);})();(function updateTimes(){uri='/files/ajax/notifications.php';$.getJSON(uri,function(data){if(data.events>0){$('.nav-extra-events').addClass('alert');$('#event-counter').fadeIn(500).text(data.events);}else{$('.nav-extra-events').removeClass('alert');$('#event-counter').fadeOut(200);}
if(data.pm>0){$('.nav-extra-pm').addClass('alert');$('#pm-counter').fadeIn(500).text(data.pm);}else{$('.nav-extra-pm').removeClass('alert');$('#pm-counter').fadeOut(200);}});setTimeout(updateTimes,20000);})();var notificationsTmpl='<tmpl>'+'{{if seen == 0}}'+'    <li class="new">'+'{{else}}'+'    <li>'+'{{/if}}'+'        <time class="short" datetime="${timestamp}">${time}</time>'+'{{if username}}'+'        <a href="/user/${username}">'+'            <img class="left" width="28" height="28" src="https://www.hackthis.co.uk/users/images/28/1:1/${img}.jpg"/>'+'        </a>'+'{{/if}}'+'{{if pm_id}}'+'            <a class="strong" href="/inbox/${pm_id}">${title}<a/><br/>'+'            ${message}'+'{{else}}'+'    {{if type == 1}}'+'            <a href="/user/${username}">${username}<a/> sent you a friend request'+'            {{if status == 0}}'+'                <a href="#">Accept</a> | <a href="#">Decline</a>'+'            {{/if}}'+'    {{else type == 2}}'+'            <a href="/user/${username}">${username}<a/> accepted your friend request<br/>'+'    {{else type == 3}}'+'            You have been awarded <a href="/medals/"><div class="medal medal-${colour}">${label}</div></a><br/>'+'    {{/if}}'+'{{/if}}'+'    </li>'+'</tmpl>';$('.nav-extra').bind('click',function(e){e.preventDefault();e.stopPropagation();var dropdown=$('#nav-extra-dropdown');var icons=$('.nav-extra').parent();var parent=$(this).parent();if(dropdown.is(":visible")&&(($(this).hasClass('nav-extra-pm')&&parent.hasClass('active-pm'))||($(this).hasClass('nav-extra-events')&&parent.hasClass('active-events')))){dropdown.slideUp(200);icons.removeClass('active');return false;}
var uri='/files/ajax/notifications.php'
icons.removeClass('active');if($(this).hasClass('nav-extra-pm')){uri+='?pm';icons.removeClass('active-events');parent.addClass('active active-pm');}else if($(this).hasClass('nav-extra-events')){uri+='?events';icons.removeClass('active-pm');$(this).removeClass('alert');$('#event-counter').fadeOut(200);parent.addClass('active active-events');}else{return false;}
$.getJSON(uri,function(data){if(data.length){$.each(data,function(index,item){var d=new Date(item.timestamp*1000);item.time=timeSince(d,true);item.timestamp=d.toISOString();});var html=$(notificationsTmpl).tmpl(data);}else{if(parent.hasClass('active-events'))
var html='<div class="center empty"><i class="icon-globe icon-4x"></i>No notifications available</div>';else
var html='<div class="center empty"><i class="icon-envelope-alt icon-4x"></i>No messages available</div>';}
dropdown.html(html).slideDown(200);});$(document).bind('click.extra-hide',function(e){if($(e.target).closest('#nav-extra-dropdown').length!=0&&$(e.target).not('.nav-extra'))return false;dropdown.slideUp(200);icons.removeClass('active');$(document).unbind('click.extra-hide');});});});if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){function pad(n){return n<10?'0'+n:n}
return this.getUTCFullYear()+'-'
+pad(this.getUTCMonth()+1)+'-'
+pad(this.getUTCDate())+'T'
+pad(this.getUTCHours())+':'
+pad(this.getUTCMinutes())+':'
+pad(this.getUTCSeconds())+'Z';};}